<%- include("./partials/header") %>

    <div id="mediaModal" class="fixed inset-0 z-50 bg-black/70 backdrop-blur-md flex items-center justify-center">
        <div class="w-[75vw] h-[90vh] bg-white rounded-2xl overflow-hidden shadow-2xl flex">

            <!-- LEFT SIDE — MEDIA -->
            <div id="mediaContent" class="w-1/2 h-full bg-black flex items-center justify-center">
                <% if (post.video) { %>
                    <video autoplay controls playsinline class="w-full h-full object-contain">
                        <source src="data:video/mp4;base64,<%= post.video.toString('base64') %>" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <% } else { %>
                        <img src="data:image/jpeg;base64,<%= post.image?.toString('base64') %>" alt="Post Image"
                            class="w-full h-full object-contain bg-black" />
                        <% } %>
            </div>

            <!-- RIGHT SIDE — POST DETAILS -->
            <div class="w-1/2 h-full bg-[#111827] text-white flex flex-col">

                <!-- Profile Section -->
                <div class="flex items-center justify-between px-6 py-4 border-b border-gray-700">
                    <div class="flex gap-5 items-center">
                        <div class="flex items-center gap-3">
                            <img src="<%= post.userId?.profilePic 
                       ? 'data:image/jpeg;base64,' + post.userId.profilePic.toString('base64') 
                       : 'https://cdn-icons-png.flaticon.com/512/149/149071.png' %>" alt="Profile"
                                class="w-10 h-10 rounded-full object-cover border border-gray-600">
                            <div>
                                <p class="font-semibold text-lg">
                                    <%= post.userId?.userName %>
                                </p>
                                <p class="text-sm text-gray-400">@<%= post.userId?.fullName || 'Unknown' %>
                                </p>
                            </div>
                        </div>

                    </div>

                    <h1 onclick="closePostDetails()" class="cursor-pointer font-sans py-2 px-4 rounded-full bg-red-700">
                        X</h1>
                </div>

                <!-- Caption -->
                <div class="px-6 py-3 border-b border-gray-700">
                    <p class="text-gray-200 leading-relaxed text-[15px]">
                        <%= post.caption %>
                    </p>
                </div>

                <!-- Comments Section -->
                <div
                    class="flex-1 overflow-y-auto px-6 py-3 space-y-4 scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-gray-900">
                    <% if (post.comments && post.comments.length> 0) { %>
                        <% post.comments.forEach(c=> { %>
                            <div class="flex items-start gap-3">
                                <img src="<%= c.userId?.profilePic 
                           ? 'data:image/jpeg;base64,' + c.userId.profilePic.toString('base64') 
                           : 'https://cdn-icons-png.flaticon.com/512/149/149071.png' %>"
                                    class="w-8 h-8 rounded-full object-cover border border-gray-700">
                                <div>
                                    <p class="text-sm font-semibold">
                                        <%= c.userId?.userName %>
                                    </p>
                                    <p class="text-sm text-gray-300">
                                        <%= c.content %>
                                    </p>
                                </div>
                            </div>
                            <% }) %>
                                <% } else { %>
                                    <p class="text-gray-500 text-center text-sm mt-5">No comments yet. Be the first!</p>
                                    <% } %>
                </div>

                <!-- Actions Section -->
                <div class="border-t border-gray-700 px-6 py-3 flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <!-- <button onclick="likePost('<%= post._id %>')" class="hover:text-red-400 transition"><i
                                class="fa-regular fa-heart text-2xl"></i></button>
                        <button onclick="commentFocus()" class="hover:text-blue-400 transition"><i
                                class="fa-regular fa-comment text-2xl"></i></button> -->
                        <button onclick="sharePost('<%=http://localhost:3000/postDetails?postId=<%=post._id %>')"
                            class="hover:text-green-400 transition"><i class="fa-solid fa-share text-2xl"></i></button>
                    </div>
                    <span class="text-sm text-gray-400">
                        <%= post.like?.length || 0 %> likes
                    </span>
                </div>

                <!-- Add Comment -->
                <!-- <form class="px-6 py-3 border-t border-gray-700 flex items-center gap-3"
                    onsubmit="addComment(event, '<%= post._id %>')">
                    <input id="commentInput" type="text" placeholder="Add a comment..."
                        class="w-full bg-transparent border-none outline-none text-sm text-gray-300 placeholder-gray-500">
                    <button type="submit"
                        class="text-blue-500 font-semibold hover:text-blue-400 transition">Post</button>
                </form> -->

            </div>
        </div>
    </div>

    <script>
        function sharePost(url) {
            if (navigator.share) {
                navigator.share({ title: "Check this out!", url });
            } else {
                navigator.clipboard.writeText(url);
                alert("Post link copied!");
            }
        }


    </script>

    <%- include("./partials/footer") %>